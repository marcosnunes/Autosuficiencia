<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <title>Novembro</title>
  
 <style>
      
	.iframe-container {
      position: relative;
      overflow: hidden;
      width: 100%;
      padding-top: 56.25%; /* Proporção de aspecto para manter a proporção do gráfico (por exemplo, 16:9 seria 56.25%) */
    }
    .iframe-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
 
 .nav-wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px;
}

.brand-logo {
  flex: 1;
  text-align: center;
}

.nav-btn-left,
.nav-btn-right {
  padding: 5px 10px;
  background-color: #ccc;
  border: none;
  font-size: 16px;
  cursor: pointer;
}

 </style>
  
</head>
<body>

<nav>
  <div class="nav-wrapper">
    <button onclick="window.location.href='10Out.html'" class="btn btn-default">&lt;</button>
    <span class="brand-logo center">Novembro</span>
    <button onclick="window.location.href='12Dez.html'" class="btn btn-default">&gt;</button>
  </div>
</nav>

<div class="container">


<div class="iframe-container">
  <iframe src="chart.html" frameborder="0"></iframe>
</div>

<script>
  function resizeIframe() {
    var iframe = document.querySelector('.iframe-container iframe');
    var container = document.querySelector('.iframe-container');
    var containerWidth = container.offsetWidth;
    var aspectRatio = 9 / 16;

    var newHeight = containerWidth * aspectRatio;
    iframe.style.height = newHeight + 'px';
  }

  window.addEventListener('load', resizeIframe);
  window.addEventListener('resize', resizeIframe);
</script>



  <div class="input-field">
    <input type="number" class="form-control" id="initialBalance" oninput="calculateTotal()" placeholder="Saldo Inicial">
    <label for="initialBalance">Saldo Inicial</label>
  </div>
  
  <div class="row">
    <div class="col s12">
      <button onclick="clearRow(this)" class="btn btn-default">Inserir Linha</button>
    </div>
  </div>

  <table id="myTable">
    <thead>
      <tr>
        <th>Descrição</th>
        <th>Débito</th> 
        <th>Crédito</th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr class="auto-insert-row">
        <td><input type="text" class="description form-control"></td>
        <td><input type="number" class="debit form-control" oninput="calculateTotal()"></td> 
        <td><input type="number" class="credit form-control" oninput="calculateTotal()"></td>
        <td><button onclick="clearRow(this)" class="btn btn-default">+</button></td>
        <td><button onclick="deleteRow(this)" class="btn btn-default">-</button></td>
      </tr>
    </tbody>
  </table>

  <p>Fechamento do mês: <span id="total"></span></p>
  <p>Total Crédito: <span id="totalCredit"></span></p>
  <p>Total Débito: <span id="totalDebit"></span></p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>

document.addEventListener('DOMContentLoaded', function() {
  M.AutoInit();
  loaddata();
  removeAutoInsertRow();
  setPreviousMonthBalance();
});

function removeAutoInsertRow() {
  var autoInsertRows = document.querySelectorAll('.auto-insert-row');
  for (var i = 0; i < autoInsertRows.length; i++) {
    autoInsertRows[i].remove();
  }
}

function calculateTotal() {
  var initialBalance = Number(document.getElementById("initialBalance").value);
  var debitTotal = 0;
  var creditTotal = 0;
  var debitInputs = document.querySelectorAll(".debit");
  var creditInputs = document.querySelectorAll(".credit");
  
  for (var i = 0; i < debitInputs.length; i++) {
    debitTotal += Number(debitInputs[i].value);
  }
  
  for (var i = 0; i < creditInputs.length; i++) {
    creditTotal += Number(creditInputs[i].value);
  }
  
  var total = initialBalance + creditTotal - debitTotal;
  // Usando toFixed(2) para mostrar apenas 2 casas decimais após a vírgula
  var formattedTotal = total.toFixed(2);
  
  document.getElementById("total").textContent = formattedTotal;
  document.getElementById("totalCredit").textContent = creditTotal.toFixed(2);
  document.getElementById("totalDebit").textContent = debitTotal.toFixed(2);
 
  savedata();
}


function savedata() {
  var totalNovembro = {};
  totalNovembro.initialBalance = document.getElementById("initialBalance").value;
  totalNovembro.total = document.getElementById("total").textContent;
  totalNovembro.rows = [];
  var tableRows = document.querySelectorAll("#myTable tbody tr:not(.auto-insert-row)");
  for (var i = 0; i < tableRows.length; i++) {
    var row = {};
    row.description = tableRows[i].querySelector(".description").value;
    row.debit = tableRows[i].querySelector(".debit").value;
    row.credit = tableRows[i].querySelector(".credit").value;
    totalNovembro.rows.push(row);
  }
  localStorage.setItem("totalNovembro", JSON.stringify(totalNovembro));
}

function loaddata() {
  var totalNovembro = JSON.parse(localStorage.getItem("totalNovembro"));
  if (totalNovembro) {
    document.getElementById("initialBalance").value = totalNovembro.initialBalance;
    var table = document.getElementById("myTable");
    for (var i = 0; i < totalNovembro.rows.length; i++) {
      var row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="text" class="description form-control" value="${totalNovembro.rows[i].description}"></td>
        <td><input type="number" class="debit form-control" oninput="calculateTotal()" value="${totalNovembro.rows[i].debit}"></td>
        <td><input type="number" class="credit form-control" oninput="calculateTotal()" value="${totalNovembro.rows[i].credit}"></td>
        <td><button onclick="clearRow(this)" class="btn btn-default">+</button></td>
        <td><button onclick="deleteRow(this)" class="btn btn-default">-</button></td>
      `;
      table.querySelector("tbody").appendChild(row);
    }
    calculateTotal();
  }
}

window.addEventListener("beforeunload", function() {
  savedata();
});

function clearRow(button) {
  var table = document.getElementById("myTable");
  var row = document.createElement("tr");
  row.innerHTML = `
    <td><input type="text" class="description form-control"></td>
    <td><input type="number" class="debit form-control" oninput="calculateTotal()"></td>
    <td><input type="number" class="credit form-control" oninput="calculateTotal()"></td>
    <td><button onclick="clearRow(this)" class="btn btn-default">+</button></td>
    <td><button onclick="deleteRow(this)" class="btn btn-default">-</button></td>
  `;
  table.querySelector("tbody").appendChild(row);
  calculateTotal();
}

function deleteRow(button) {
  var table = document.getElementById("myTable");
  button.closest("tr").remove();
  calculateTotal();
}

function setPreviousMonthBalance() {
  var previousMonthData = JSON.parse(localStorage.getItem("totalOutubro")); // Altere "Outubro" para o mês anterior
  if (previousMonthData) {
    var previousMonthTotal = Number(previousMonthData.total);
    document.getElementById("initialBalance").value = previousMonthTotal;
    calculateTotal();
  }
}

</script>

</body>
</html>
